[TOC]
## 内存管理
 **无论是虚拟内存管理还是物理内存管理，都是对物理页的管理，虚拟内存只是通过页表这种数据结构将物理页组织起来了**。对于虚拟内存的管理，我最开始理解有误，虚拟内存管理即对页表的管理实际上是对页表所占的物理页的管理。页表就是一个物理页，它存放的是PTE，PTE就是一个物理页的基地址+访问权限。
页表的访问权限标志位u、w、r、x、v。
虽然课上没有说明，我认为当v为1，w，r，x为0，表明当前PTE指向了一个页表。因为数据页应该是要有w、r、x权限中的一种。
v是需要理解一下，v表示当前PTE是否有效，就是当前PTE对应的物理地址是否有效。这对于理解freewalk和uvmmap有帮助。
### 物理内存管理
 **对于物理内存这种一页一页的对象，管理的方法有两种：**
  * **空闲链表法**：将空闲页串起来，分配就是删除一个结点，回收就是插入一个结点。
  * **位图**：额外拿出一页当作位图，一位表示一页/块的使用情况，通常 1 表示使用中，0 表 示空闲。
 Xv6通过空闲链表法来管理物理内存的分配和回收。物理内存的分配和回收主要通过**Kalloc、kinit、kfree和krangefree**四个函数。
    * **Kinit**: 将物理内存分成多个页，一页4kb，通过链表进行页与页之间连接，并且通过lock来保证并发情况下内存管理正常。
    * **Kalloc**：从空闲链表中获取一个物理页。
    * **kfree**：释放一个物理页，并将物理页加入到空闲链表中
    * **krangefree**： 释放一段连续的物理页，并加入到空闲链表中。
物理地址是56位，前44位表示物理页号，后12位表示页内偏移。


